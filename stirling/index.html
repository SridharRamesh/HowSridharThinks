<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8" />
        <meta name="referrer" content="no-referrer">

        <!-- Enable responsiveness on mobile devices-->
        <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5" />

        <title>Stirling&#x27;s approximation | How Sridhar Thinks</title>
<meta property="og:title" content="Stirling&#x27;s approximation | How Sridhar Thinks" />
<meta name="twitter:title" content="Stirling&#x27;s approximation | How Sridhar Thinks" />

        
<meta name="description" content="Where does Stirling's approximation $$n! \sim \sqrt{2\pi n} \left(\frac{n}{e}\right)^n$$ come from? Well, $$n! = \prod_{t = 1}^{n} t$$, a discrete product. One obvious way to try to approximate a solution for $$n!$$ is to switch from discrete series to continuous series. People d…">
<meta property="og:description" content="Where does Stirling's approximation $$n! \sim \sqrt{2\pi n} \left(\frac{n}{e}\right)^n$$ come from? Well, $$n! = \prod_{t = 1}^{n} t$$, a discrete product. One obvious way to try to approximate a solution for $$n!$$ is to switch from discrete series to continuous series. People d…">
<meta name="twitter:description" content="Where does Stirling's approximation $$n! \sim \sqrt{2\pi n} \left(\frac{n}{e}\right)^n$$ come from? Well, $$n! = \prod_{t = 1}^{n} t$$, a discrete product. One obvious way to try to approximate a solution for $$n!$$ is to switch from discrete series to continuous series. People d…">

        <meta property="og:site_name" content="How Sridhar Thinks" />
        <meta property="og:url" content="https:&#x2F;&#x2F;sridharramesh.github.io&#x2F;HowSridharThinks&#x2F;" />

        

<script>
MathJax = {
  tex: {
    inlineMath: [['$$', '$$'], ['open', 'close'], ['\\(', '\\)']],
    displayMath: [['\\[', '\\[']],
    packages: {'[+]': ['physics']}
  },
  loader: {load: ['[tex]/physics']},
  svg: {
    fontCache: 'global'
  }
};
</script>

<script type="text/javascript" id="MathJax-script" async
  src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-svg.js">
</script>



        
<link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
<link rel="stylesheet" href="https://sridharramesh.github.io/HowSridharThinks/base.css" />
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>

<link href="https://sridharramesh.github.io/HowSridharThinks/fontawesome/fontawesome.css" rel="stylesheet">
<link href="https://sridharramesh.github.io/HowSridharThinks/fontawesome/brands.css" rel="stylesheet">
<link href="https://sridharramesh.github.io/HowSridharThinks/fontawesome/solid.css" rel="stylesheet">

        <link rel='icon' type='image/x-icon' href="https://sridharramesh.github.io/HowSridharThinks/favicon.ico" />

        

        

        

    </head>
    <body>
        <a href="#main" class="skip-link p-screen-reader-text">Skip to content</a>
        <header class="l-header">
            <h1 class="c-title p-title"><a href="https:&#x2F;&#x2F;sridharramesh.github.io&#x2F;HowSridharThinks&#x2F;" class="p-title__link">How Sridhar Thinks</a></h1>
            </header>

        <main id="main" class="l-main">
            
<article class="p-article">
  <header>
    <h1>Stirling&#x27;s approximation
</h1>
    <div>
      <div class="c-time">

        <time datetime=" 2020-09-05">
          2020-09-05
        </time>
        
      </div>
    </div>
  </header>
  
  <section id="js-article" class="p-article__body">
    <p>Where does Stirling's approximation $$n! \sim \sqrt{2\pi n} \left(\frac{n}{e}\right)^n$$ come from?</p>
<p>Well, $$n! = \prod_{t = 1}^{n} t$$, a discrete product. One obvious way to try to approximate a solution for $$n!$$ is to switch from discrete series to continuous series. People don't like to talk about multiplicative integrals (though it would be perfectly fine), they like to put things into additive terms, so let's go ahead and apply a logarithm to turn all our multiplications into additions. Define $$L(n) = \log(n!) = \sum_{t = 1}^{n} \log(t)$$. Now, if we approximate the discrete summation with a continuous integral, we're looking at the integral of the natural logarithm from $$0$$ (or just as well from $$1$$; from anywhere we want our logarithmic factorial to be zero) up through $$n$$. This comes out to $$n (\log(n) - 1)$$. Undoing the logarithm, this gives us an approximation of $$A(n) = \left(\frac{n}{e}\right)^n$$ for $$n!$$.</p>
<p>How good is this approximation? Does it even satisfy the recurrence defining the factorial? Well, $$\frac{A(n + 1)}{A(n)} = \left(1 + \frac{1}{n}\right)^n (n + 1) e^{-1}$$. This isn't quite the same as $$(n + 1)$$, but it's close. Put another way, $$\frac{A(n + 1)/(n + 1)!}{A(n)/n!} = \left(1 + \frac{1}{n}\right)^n e^{-1}$$.</p>
<p>For large $$n$$, this of course approaches $$1$$. But in general, this tells us that $$\frac{A(n)}{n!} = e^{-1} \prod_{t = 1}^{n - 1} \left(1 + \frac{1}{t}\right)^t e^{-1}$$.</p>
<p>What is the asymptotic behavior of this series? Well, again, people like to talk about things summatively rather than multiplicatively, so let's apply a logarithm. This turns our series into $$-1 + \sum_{t = 1}^{n - 1} [t \log \left(1 + \frac{1}{t} \right) - 1] = -1 + \sum_{t = 1}^{n - 1} [-\frac{1}{2t} + \frac{1}{3t^2} - \frac{1}{4t^3} + \ldots]$$, using the Mercator series expansion of the logarithm.</p>
<p>Asymptotically, we have that $$\sum_{t = 1}^{n - 1} -\frac{1}{2t} \approx -\frac{1}{2} \log(n) = \log(n^{-1/2})$$, while all the further summations of $$\sum_{t = 1}^{n - 1} [\frac{1}{3t^2} - \frac{1}{4t^3} + \ldots]$$ converge as $$n \to \infty$$. The $$\approx$$ here represents a difference which also converges as $$n \to \infty$$ (this amounts to the existence of the Euler-Mascheroni constant $$\gamma$$). Thus, overall, we find that $$\frac{A(n)}{n! n^{-1/2}}$$ approaches a constant as $$n$$ grows large.</p>
<p>In other words, $$n! \sim F \sqrt{n} \left(\frac{n}{e}\right)^n$$, for some constant $$F$$. This is Stirling's approximation.</p>
<p>What is the value of that constant $$F$$? Well, this can be determined by using the duplication formula for the factorial.</p>
<h1 id="duplication-multiplication-formula">Duplication/Multiplication Formula</h1>
<p>Let $$f_M(x) = \prod_{T = 0}^{M - 1} [\left(x - \frac{T}{M}\right)!]$$. Note that $$f_M(x/M) M^{x}$$ clearly satisfies the same "pseudopolynomiality" and recurrence as a function of $$x$$ that $$x!$$ does. So the two are equal up to a constant of proportionality, which is readily determined. See this discussion of the <a href="https://sridharramesh.github.io/HowSridharThinks/factorialgeneralized/">generalized factorial</a>.</p>
<p>That is, there is some $$\lambda(M)$$ such that $$f_M(x/M) M^{x} = x! \lambda(M)$$. Put another way, $$f_M(x) = (Mx)! M^{-Mx} \lambda(M)$$.</p>
<p>This is the "multiplication theorem"; when $$M = 2$$, people call it the "duplication theorem".</p>
<p>But what is $$\lambda(M)$$? Well, plugging in $$x = 0$$, it's clear that $$\lambda(M)$$ is $$f_M(0)$$, the product of $$x!$$ over all rational $$x$$ in $$(-1, 0]$$ with denominator $$M$$. In particular, $$\lambda(2)$$ is $$(-1/2)!$$. But we can say more about the general behavior of this $$\lambda(M)$$ as a function of $$M$$.</p>
<p>Observe that $$f_{MN}(x)$$ can be decomposed as $$\prod_{T = 0}^{N - 1} f_M \left(x - \frac{T}{MN} \right)$$. By our multiplication theorem, the left-hand side here is $$(MNx)! (MN)^{-MNx} \lambda(MN)$$. And the right-hand side is $$\prod_{T = 0}^{N - 1} [\left(Mx - \frac{T}{N} \right)! M^{-Mx + \frac{T}{N}} \lambda(M)] = M^{-MNx} M^{(N - 1)/2} \lambda(M)^N f_N(Mx)$$, which by applying the multiplication theorem again, is $$(MNx)! (MN)^{-MNx} M^{(N - 1)/2} \lambda(M)^N \lambda(N)$$.</p>
<p>Identifying our two sides, we find $$\lambda(MN) = M^{(N - 1)/2} \lambda(M)^N \lambda(N)$$. If we now write $$g(M) = \lambda(M) M^{1/2}$$, we find that $$g(MN) = g(M)^N g(N)$$. Symmetrically, we also have $$g(MN) = g(N)^M g(M)$$ then. Identifying these two, dividing by $$g(M) g(N)$$, and taking $$(M - 1)(N - 1)$$th roots, we find that there is a constant value $$g(M)^{1/(M - 1)} = g(N)^{1/(N - 1)} = b$$ such that in general $$g(M) = b^{M - 1}$$.</p>
<p>We could derive $$\lambda(M)$$ also like so (essentially the infinite N case of the above): Consider the integral from $$-1$$ to $$0$$ of $$\log(x!)$$. By breaking this up into $$M$$ many intervals, this is equivalently the integral from $$-1/m$$ to $$0$$ of $$\log(f_M(x)) = \log((Mx)!) - M\log(M)x + \log(\lambda(M))$$. The first term here integrates to $$\frac{1}{M}$$ times the whole value, and the second term here integrates to $$\frac{\log(M)}{2M}$$, so we ultimately find $$\left(\int_{-1}^{0} \log(x!) dx\right)(M - 1) - \frac{\log(M)}{2} = \log(\lambda(M))$$. This replicates our formula given above, with $$\int_{-1}^{0} \log(x!) dx$$ as the magic constant $$b$$.</p>
<p>Going back and plugging this all into our original multiplication theorem, we have that $$f_M(x) = (Mx)! M^{-Mx - 1/2} b^{M - 1}$$. As for the actual value of $$b$$, it follows, of course, that $$b = g(2) = \lambda(2) \sqrt{2} = (-1/2)! \sqrt{2}$$, as well as that $$b = \int_{-1}^{0} \log(x!) dx$$ as we just saw.</p>
<p>Now, looking at the Stirling asymptotics on any particular case (perhaps most easily the $$M = 2$$ or $$M = \infty$$ cases) of the multiplication theorem as we look at $$(x + N)!$$ with $$N$$ large, we conclude that the Stirling theorem constant $$F$$ is the same as the multiplication theorem constant $$b$$.</p>
<p>Indeed, just as well, we could've concluded Stirling's theorem directly from the multiplication theorem like so: By the trapezoid rule, we know that $$\int_{0}^{1} \log(x!) dx$$ is equal to $$\log(f_N(1))/N$$ plus an error term which is $$O(N^{-2})$$. But $$\int_{0}^{1} \log(x!) dx = \int_{0}^{1} \log((x - 1)!) + \log(x) dx = b - 1$$, and our multiplication theorem tells us that $$\log(f_N(1)) = \log(N!) - N\log(N) + (N - 1)b - \log(N)/2$$. Thus, $$N (b - 1) = \log(N!) - N\log(N) + (N - 1)b - \log(N)/2 + O(N^{-1})$$, which means $$\log(N!) = b + \log(N)/2 + N(\log(N) - 1) + O(N^{-1})$$, which is Stirling's approximation.</p>
<p>[TODO: If you know the reflection formula $$z!(-z)! = 1/sinc(\pi z)$$, then the multiplication theorem for the factorial is equivalent to a multiplication theorem for sine, by pairing up each (k/M)! with (1 - k/M)! = (-k/M)!(1 - k/M). This multiplication theorem for sine should be the same as what I illustrated in my 3blue1brown video on the sine product. Is there a natural calculus way to turn the gamma function integral into the reflection formula? There's a clear way to get the reflection formula once one has both the infinite products for sine and factorial, of course.]</p>
<h1 id="how-does-this-relate-to-pi">How does this relate to $$\pi$$?</h1>
<p>But what is $$\left(-\frac{1}{2}\right)!$$? Well...</p>
<p>By applying the Stirling formula to $$\binom{2n}{n} = \frac{(2n)!}{n!^2}$$, we automatically get $$\binom{2n}{n} \sim \frac{4^n}{F \sqrt{n/2}}$$. Note that we can read the Wallis Product in these terms as well. $$ \frac{2}{1} \times \frac{4}{3} \times \frac{6}{5} \times \ldots \times \frac{2n}{2n - 1} = \frac{2^n n!}{\frac{(2n)!}{2^n n!}} = \frac{4^n}{\binom{2n}{n}} \sim F \sqrt{n/2}$$. And $$ \frac{2}{3} \times \frac{4}{5} \times \frac{6}{7} \times \ldots \times \frac{2n}{2n + 1}$$ in the same way comes out to $$\frac{4^n}{\binom{2n}{n}} \times \frac{1}{2n + 1} \sim F \sqrt{n/2} / (2n)$$. Multiplying these together gives us that the Wallis Product comes to $$\frac{F^2}{4}$$.</p>
<p>If we happen to know that the Wallis Product comes to $$\frac{\pi}{2}$$ (see <a href="https://sridharramesh.github.io/HowSridharThinks/wallisproductgeometric/">Wallis Product proved by higher-dimensional geometry</a> and <a href="https://sridharramesh.github.io/HowSridharThinks/sineproductproofs/">Wallis Product as instance of sine product</a>), then we can conclude that $$F = \sqrt{2 \pi}$$.</p>
<p>Actually, this just amounts to using the two-factor multiplication formula implicitly again to relate the Stirling constant to (-1/2)!, and then using the Wallis product to compute (-1/2)!. It's not actually different from the previous. But some may enjoy seeing it presented in this language, instead of in terms of the multiplication formula language.</p>
<p>See also <a href="https://sridharramesh.github.io/HowSridharThinks/donvolution/">Donvolution</a>, whose general formula tells us that in particular, the area of a quarter-circle of unit radius is given by $$\left(\frac{1}{2}\right)!^2$$, so that $$\left(\frac{1}{2}\right)! = \sqrt{\pi}/2$$ and thus $$\left(-\frac{1}{2}\right)! = \sqrt{\pi}$$.</p>
<h1 id="todo">TODO</h1>
<p>[TODO: Talk about the full Stirling series and how to derive it as a non-convergent asymptotic expansion. This should be viewed as a series for the trigamma function, as trigamma(z) = sum of B_n/z^(n + 1), using the +1/2 convention (B_n(1)). This can be seen be seeing that G(z) = sum of B_n z^n satisfies the formal recurrence that G(z/(1 - z)) - G(z) = z^2. See Proposition A.1 on page 241 of https://people.mpim-bonn.mpg.de/zagier/files/doi/10.1007/978-4-431-54919-2/curious-bernoulli.pdf. We can also see this just by using the full Euler-Maclaurin formula for integrating log(x!) from 0 to 1 using N steps, or for integrating log(x) from 0 to N using N steps.]</p>
<p>[TODO: Note we can also derive the Stirling approximation from the infinite-factor multiplication formula, by considering (x + N)! as (N * (x/N + 1))!, maybe? This is sort of analogous to the step in the Stirling approximation where we approximate the discrete summation with a continuous integral. Well, some of the stuff we've written above about the relationship between the Stirling approximation and the multiplication theorem is already in this vein.]</p>

  </section>
  <footer>
    <nav class="c-pagination p-pagination">
      <div class="c-pagination__ctrl">
        <div class="c-pagination__newer">
          
        </div>
        <div class="c-pagination__older">
          
        </div>
      </div>
    </nav>
  </footer>
</article>
            
        </main>


      <footer class="l-footer">
          <p class="p-copyright">
              
          </p>
      </footer>

      
    </body>
</html>

